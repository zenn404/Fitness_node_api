{"version":3,"names":["_tools","require","_react","_react2","_interopRequireWildcard","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","exitableByKey","children","map","Map","Children","forEach","child","isValidElement","_motionChild$props","motionChild","key","props","exit","isString","AnimatePresence","fr","useForceRender","childArr","toArray","childrenPrevious","usePrevious","childrenByKey","childrenByKeyPrevious","exiting","useRef","prevChild","current","childrenToRender","delete","index","indexOf","splice","createElement","Fragment","motionExit","animKeys","keys","cloneElement","animate","onAnimationComplete","animKey","arrayRemove","length"],"sources":["AnimatePresence.tsx"],"sourcesContent":["import { arrayRemove, isString } from '@legendapp/tools';\nimport { useForceRender, usePrevious } from '@legendapp/tools/react';\nimport React, { Children, cloneElement, isValidElement, Key, ReactElement, ReactNode, useRef } from 'react';\n\ninterface Props {\n    children: ReactNode;\n}\n\ntype MotionChildProps = {\n    exit?: Record<string, any>;\n    animate?: Record<string, any>;\n    onAnimationComplete?: (key: string) => void;\n} & Record<string, any>;\n\nfunction exitableByKey(children: ReactNode[]) {\n    const map = new Map<Key, ReactElement<MotionChildProps>>();\n    Children.forEach(children, (child) => {\n        if (isValidElement(child)) {\n            const motionChild = child as ReactElement<MotionChildProps>;\n            if (motionChild.key && motionChild.props?.exit && isString(motionChild.key)) {\n                map.set(motionChild.key, motionChild);\n            }\n        }\n    });\n    return map;\n}\n\nexport function AnimatePresence({ children }: Props) {\n    const fr = useForceRender();\n    const childArr = Children.toArray(children);\n    const childrenPrevious = usePrevious(childArr);\n\n    // Map children and previous children to { key: child }\n    const childrenByKey = exitableByKey(childArr);\n    const childrenByKeyPrevious = usePrevious(childrenByKey);\n\n    // Add newly exited elements to the exiting map\n    const exiting = useRef(new Map<Key, ReactElement<MotionChildProps>>());\n    if (childrenByKeyPrevious) {\n        childrenByKeyPrevious.forEach((prevChild, key) => {\n            if (!childrenByKey.get(key)) {\n                exiting.current.set(key, prevChild);\n            }\n        });\n    }\n\n    // Render exiting elements into the position they were previously\n    let childrenToRender = [...childArr];\n    exiting.current.forEach((child, key) => {\n        if (childrenByKey.get(key)) {\n            exiting.current.delete(key);\n        } else {\n            const index = childrenPrevious.indexOf(child);\n            childrenToRender.splice(index, 0, child);\n        }\n    });\n\n    return (\n        <>\n            {childrenToRender.map((child) => {\n                if (isValidElement(child)) {\n                    const motionChild = child as ReactElement<MotionChildProps>;\n                    const { exit: motionExit } = motionChild.props;\n                    if (motionExit) {\n                        const key = motionChild.key;\n                        const animKeys = Object.keys(motionExit);\n                        // Remove the child when all exit animations end\n                        return key && exiting.current.get(key) && animKeys\n                            ? cloneElement(motionChild, {\n                                  animate: motionExit,\n                                  onAnimationComplete: (animKey) => {\n                                      if (exiting.current.has(key)) {\n                                          arrayRemove(animKeys, animKey);\n                                          if (animKeys.length === 0) {\n                                              exiting.current.delete(key);\n                                              fr();\n                                          }\n                                      }\n                                  },\n                              })\n                            : motionChild;\n                    }\n                }\n                return child;\n            })}\n        </>\n    );\n}\n"],"mappings":"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","ignoreList":[]}