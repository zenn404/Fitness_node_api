{"version":3,"names":["arrayRemove","isString","useForceRender","usePrevious","React","Children","cloneElement","isValidElement","useRef","exitableByKey","children","map","Map","forEach","child","_motionChild$props","motionChild","key","props","exit","set","AnimatePresence","fr","childArr","toArray","childrenPrevious","childrenByKey","childrenByKeyPrevious","exiting","prevChild","get","current","childrenToRender","delete","index","indexOf","splice","createElement","Fragment","motionExit","animKeys","Object","keys","animate","onAnimationComplete","animKey","has","length"],"sources":["AnimatePresence.tsx"],"sourcesContent":["import { arrayRemove, isString } from '@legendapp/tools';\nimport { useForceRender, usePrevious } from '@legendapp/tools/react';\nimport React, { Children, cloneElement, isValidElement, Key, ReactElement, ReactNode, useRef } from 'react';\n\ninterface Props {\n    children: ReactNode;\n}\n\ntype MotionChildProps = {\n    exit?: Record<string, any>;\n    animate?: Record<string, any>;\n    onAnimationComplete?: (key: string) => void;\n} & Record<string, any>;\n\nfunction exitableByKey(children: ReactNode[]) {\n    const map = new Map<Key, ReactElement<MotionChildProps>>();\n    Children.forEach(children, (child) => {\n        if (isValidElement(child)) {\n            const motionChild = child as ReactElement<MotionChildProps>;\n            if (motionChild.key && motionChild.props?.exit && isString(motionChild.key)) {\n                map.set(motionChild.key, motionChild);\n            }\n        }\n    });\n    return map;\n}\n\nexport function AnimatePresence({ children }: Props) {\n    const fr = useForceRender();\n    const childArr = Children.toArray(children);\n    const childrenPrevious = usePrevious(childArr);\n\n    // Map children and previous children to { key: child }\n    const childrenByKey = exitableByKey(childArr);\n    const childrenByKeyPrevious = usePrevious(childrenByKey);\n\n    // Add newly exited elements to the exiting map\n    const exiting = useRef(new Map<Key, ReactElement<MotionChildProps>>());\n    if (childrenByKeyPrevious) {\n        childrenByKeyPrevious.forEach((prevChild, key) => {\n            if (!childrenByKey.get(key)) {\n                exiting.current.set(key, prevChild);\n            }\n        });\n    }\n\n    // Render exiting elements into the position they were previously\n    let childrenToRender = [...childArr];\n    exiting.current.forEach((child, key) => {\n        if (childrenByKey.get(key)) {\n            exiting.current.delete(key);\n        } else {\n            const index = childrenPrevious.indexOf(child);\n            childrenToRender.splice(index, 0, child);\n        }\n    });\n\n    return (\n        <>\n            {childrenToRender.map((child) => {\n                if (isValidElement(child)) {\n                    const motionChild = child as ReactElement<MotionChildProps>;\n                    const { exit: motionExit } = motionChild.props;\n                    if (motionExit) {\n                        const key = motionChild.key;\n                        const animKeys = Object.keys(motionExit);\n                        // Remove the child when all exit animations end\n                        return key && exiting.current.get(key) && animKeys\n                            ? cloneElement(motionChild, {\n                                  animate: motionExit,\n                                  onAnimationComplete: (animKey) => {\n                                      if (exiting.current.has(key)) {\n                                          arrayRemove(animKeys, animKey);\n                                          if (animKeys.length === 0) {\n                                              exiting.current.delete(key);\n                                              fr();\n                                          }\n                                      }\n                                  },\n                              })\n                            : motionChild;\n                    }\n                }\n                return child;\n            })}\n        </>\n    );\n}\n"],"mappings":"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","ignoreList":[]}